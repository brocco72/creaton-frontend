"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("wonka"),n=require("graphql");function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}var t=function(e){return{type:"debug-event",source:"exchange",data:r(r({},e),{source:"devtoolsExchange",timestamp:Date.now()})}},o=function(){var e=Error.stackTraceLimit;Error.stackTraceLimit=Infinity;var n=(new Error).stack||"";Error.stackTraceLimit=e;var r=/(useQuery|useMutation|useSubscription).*\n\s*at (\w+)/.exec(n);return null===r?"Unknown":r[2]},a={source:"exchange",type:"connection-init",version:"2.0.2"};function i(e){return window.postMessage(JSON.parse(JSON.stringify(e)),window.location.origin)}var s,u,c={"execute-query":function(r){var t=r.client;return function(r){var o,a=/(^|\W)+mutation\W/.test(r.query),i=t.createRequestOperation(a?"mutation":"query",{key:(o=JSON.stringify(r.query),function(e,n){e|=0;for(var r=0,t=0|n.length;r<t;r++)e=(e<<5)+e+n.charCodeAt(r);return e}(5381,o)>>>0),query:n.parse(r.query)},{meta:{source:"Devtools"}});e.pipe(t.executeRequestOperation(i),e.take(1),e.toPromise)}},"connection-init":function(e){var n=e.sendMessage;return function(){return n({type:"connection-acknowledge",source:"exchange",version:"2.0.2"})}}},d=(u=!(s="undefined"!=typeof navigator&&"ReactNative"===(null===navigator||void 0===navigator?void 0:navigator.product))&&"undefined"==typeof window,"production"===process.env.NODE_ENV||u?function(n){var r=n.forward;return function(n){return e.pipe(n,r)}}:function(n){var r=n.sendMessage,a=n.addMessageListener;function i(e){return r({type:"debug-event",source:"exchange",data:e})}return function(n){var s=n.client,u=n.forward;return a((function(e){"devtools"===e.source&&e.type in c&&c[e.type]({client:s,sendMessage:r})(e)})),s.subscribeToDebugTarget&&s.subscribeToDebugTarget(i),function(n){return e.pipe(n,e.tap(function(e){var n=e.sendMessage;return function(e){if("teardown"===e.operationName){var r=t({type:"teardown",message:"The operation has been torn down",operation:e});return n(r)}var a=t({type:"execution",message:"The client has received an execute command.",operation:e,data:{sourceComponent:o()}});return n(a)}}({client:s,sendMessage:r})),u,e.tap(function(e){var n=e.sendMessage;return function(e){var r=e.operation,o=e.data,a=e.error;if(a){var i=t({type:"error",message:"The operation has returned a new error.",operation:r,data:{value:a}});return n(i)}var s=t({type:"update",message:"The operation has returned a new response.",operation:r,data:{value:o}});n(s)}}({client:s,sendMessage:r})))}}}(s?function(){var e,n,r=[];function t(){e.send(JSON.stringify(a))}function o(){n=n||setTimeout(u,500)}function i(){n=n||setTimeout(u,500)}function s(e){try{if(!e.data)return;r.forEach((function(n){return n(JSON.parse(e.data))}))}catch(e){console.warn(e)}}var u=function(){n=void 0,(e=new WebSocket("ws://localhost:7700")).onopen=t,e.onclose=o,e.onerror=i,e.onmessage=s};return u(),{addMessageListener:function(e){r=r.concat([e])},sendMessage:function(n){e.readyState===e.OPEN&&e.send(JSON.stringify(n))}}}():function(){var e=[];window.addEventListener("message",(function(n){var r=n.data;n.isTrusted&&(null==r?void 0:r.source)&&e.forEach((function(e){return e(r)}))}));var n=i;return n(a),{addMessageListener:function(n){return e=e.concat([n])},sendMessage:n}}()));exports.devtoolsExchange=d;
//# sourceMappingURL=urql-devtools-exchange.min.js.map
