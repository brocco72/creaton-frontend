var __awaiter=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,i)}s((o=o.apply(e,n||[])).next())})};!function(e){if("object"==typeof module&&"object"==typeof module.exports){var n=e(require,exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd&&define(["require","exports","./internals","named-logs"],e)}(function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.proxyWeb3Provider=n.proxyContract=void 0;const t=e("./internals"),o=e("named-logs").logs("web3w:ethers");function r(e,n,{onTxRequested:t,onTxCancelled:o,onTxSent:r,onSignatureRequested:a,onSignatureCancelled:c,onSignatureReceived:i}){n=Object.assign({sendTransaction:(n,a,c)=>__awaiter(this,void 0,void 0,function*(){const i=yield e.getAddress(),s=yield(yield e.getChainId()).toString(),d=Object.assign(Object.assign({},c[0]),{from:i,chainId:s});let u;t(d);try{u=yield n.bind(a)(...c)}catch(e){throw o(d),e}return r(Object.assign(Object.assign({},u),{chainId:s})),u}),signMessage:(n,t,o)=>__awaiter(this,void 0,void 0,function*(){const r=yield e.getAddress(),s={from:r,message:o[0]};let d;a(s);try{d=yield n.bind(t)(...o)}catch(e){throw c(s),e}return i({from:r,signature:d}),d})},n);const s={};return new Proxy(e,{get:(t,o)=>{const r=n[o];return r?function(n,t){let o=s[n];return o||(o=new Proxy(e[n],t),s[n]=o),o}(o,{apply:r}):t[o]}})}function a(e,n){return r(e,{connectUnchecked:(e,t,o)=>{return function(e,n){return r(e,{},n)}(e.bind(t)(...o),n)}},n)}n.proxyContract=function e(n,r,a,c){o.log("PROXY",{name:r});const i=c?Object.assign({onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},c):{onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},{onContractTxRequested:s,onContractTxCancelled:d,onContractTxSent:u}=i,f={},l=n.interface.fragments.filter(e=>"event"===e.type).map(e=>JSON.parse(e.format("json"))),g=n.interface.functions,p={};for(const e of Object.keys(g))p[g[e].name]=e;const y={};for(const e of Object.keys(n))y[e]=n[e];y.functions={};for(const e of Object.keys(n.functions))y.functions[e]=n.functions[e];function x(e,t){let o=f[t];if(!o){let c=n.interface.functions[t];c||(c=n.interface.functions[p[t]]),o=new Proxy(e[t],{apply:(o,i,f)=>__awaiter(this,void 0,void 0,function*(){const i=yield n.signer.getAddress(),g=f.length;let p,y,x,m=f;g===c.inputs.length+1&&"object"==typeof f[g-1]&&(m=m.slice(0,g-1),p=f[g]),p&&(y=p.metadata,delete(p=Object.assign({},p)).metadata),s({to:n.address,from:i,chainId:a,eventsABI:l,contractName:r,args:m,method:t,overrides:p,metadata:y});try{x=yield o.bind(e)(...f)}catch(e){throw d({to:n.address,from:i,chainId:a,eventsABI:l,contractName:r,args:m,method:t,overrides:p,metadata:y}),e}return u({hash:x.hash,to:n.address,from:i,chainId:a,eventsABI:l,contractName:r,args:m,method:t,overrides:p,metadata:y}),x})}),f[t]=o}return o}const m=new Proxy(y.functions,{get:(e,t)=>x(n.functions,t)});return new Proxy(y,{get:(t,o)=>"functions"===o?m:n.functions[o]?x(n.functions,o):"_proxiedContract"===o?n:"connect"===o?t=>e(n.connect(t),r,a,c):"toJSON"===o?()=>({address:n.address,abi:n.interface.fragments,functionsSignatures:n.interface.fragments.map(e=>e.format("full"))}):t[o]})},n.proxyWeb3Provider=function(e,n){const o=n?Object.assign({onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},n):{onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},r=new Proxy(e.getSigner,{apply:(n,t,r)=>a(n.bind(e)(...r),o)});return new Proxy(e,{get:(e,n)=>"getSigner"===n?r:"signMessage"===n?r:"sendTransaction"===n?r:"connectUnchecked"===n?r:e[n]})}});